<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlutterPage - ç™»å½•</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../static/css/common.css">
    <style>
        /* ç™»å½•é¡µé¢ç‰¹æœ‰æ ·å¼ */
        .login-page {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--primary-color));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--space-lg);
            position: relative;
            overflow: hidden;
        }

        .login-container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            z-index: 1;
        }

        .login-card {
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            background-color: var(--card-bg);
            border-radius: var(--radius-xl);
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow-heavy);
            color: var(--text-dark);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0) 60%);
            transform: rotate(30deg);
            z-index: -1;
        }

        .login-card-header {
            padding: var(--space-xl) var(--space-xl) 0;
            flex-shrink: 0;
        }

        .login-logo {
            text-align: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-logo h1 {
            font-size: var(--text-5xl);
            font-weight: 800;
            background: linear-gradient(45deg, var(--text-dark), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
            margin-bottom: var(--space-sm);
            line-height: 1.2;
        }

        .login-logo p {
            font-size: var(--text-lg);
            color: var(--text-light);
            letter-spacing: 0.5px;
            line-height: 1.5;
            font-weight: 500;
        }

        /* èº«ä»½é€‰æ‹©æ ·å¼ */
        .role-selector {
            margin-bottom: var(--space-lg);
            text-align: center;
        }

        .role-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            padding: var(--space-xs);
            margin-bottom: var(--space-md);
        }

        .role-tab {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            text-align: center;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-normal) ease;
            font-weight: 500;
            font-size: var(--text-sm);
            user-select: none;
        }

        .role-tab.active {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: var(--text-white);
            box-shadow: var(--shadow-light);
        }

        .role-description {
            font-size: var(--text-sm);
            color: var(--text-light);
            margin-bottom: var(--space-md);
            min-height: 1.5em;
        }

        /* è¡¨å•å®¹å™¨ - å¯æ»šåŠ¨ */
        .form-scroll-container {
            flex: 1;
            overflow-y: auto;
            padding: 0 var(--space-xl) var(--space-xl);
            max-height: 500px;
        }

        .form-scroll-container::-webkit-scrollbar {
            width: 6px;
        }

        .form-scroll-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
        }

        .form-scroll-container::-webkit-scrollbar-thumb {
            background: rgba(106, 133, 182, 0.5);
            border-radius: var(--radius-full);
        }

        .form-scroll-container::-webkit-scrollbar-thumb:hover {
            background: rgba(106, 133, 182, 0.7);
        }

        .auth-form {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .auth-form.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .input-group {
            position: relative;
            margin-bottom: var(--space-lg);
        }

        .input-group input {
            width: 100%;
            padding: var(--space-md) var(--space-lg) var(--space-md) 50px;
            border: none;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: var(--text-dark);
            font-size: var(--text-base);
            transition: all var(--transition-normal) ease;
            box-shadow: var(--shadow-light);
        }

        .input-group input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 15px rgba(106, 133, 182, 0.4);
            transform: translateY(-2px);
        }

        .input-group i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: var(--text-xl);
            transition: all var(--transition-normal) ease;
        }

        .input-group input:focus + i {
            color: var(--accent-color);
            transform: translateY(-50%) scale(1.2);
        }

        .input-group input::placeholder {
            color: #9cadc5;
        }

        .input-error {
            border-color: var(--error-color) !important;
        }

        .error-message {
            color: var(--error-color);
            font-size: var(--text-sm);
            margin-top: var(--space-xs);
            margin-left: var(--space-lg);
            display: none;
        }

        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            font-size: var(--text-sm);
        }

        .remember {
            display: flex;
            align-items: center;
            color: var(--text-dark);
        }

        .remember input {
            margin-right: var(--space-xs);
            accent-color: var(--primary-color);
        }

        .forgot-link {
            color: var(--primary-color);
            text-decoration: none;
            transition: all var(--transition-normal) ease;
            font-weight: 500;
        }

        .forgot-link:hover {
            text-decoration: underline;
            color: var(--accent-color);
        }

        .login-btn {
            width: 100%;
            padding: var(--space-md);
            border: none;
            border-radius: var(--radius-full);
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: var(--text-white);
            font-size: var(--text-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal) ease;
            box-shadow: var(--shadow-light);
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            margin-top: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: var(--transition-slow);
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .login-btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-light);
        }

        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-light);
        }

        .login-btn:disabled::before {
            display: none;
        }

        .form-switch {
            text-align: center;
            margin-top: var(--space-md);
            font-size: var(--text-sm);
            color: var(--text-dark);
            padding-top: var(--space-md);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            transition: all var(--transition-normal) ease;
            margin-left: var(--space-xs);
            cursor: pointer;
        }

        .form-switch a:hover {
            text-decoration: underline;
            color: var(--accent-color);
        }

        /* ä½œè€…æ³¨å†Œé¢å¤–å­—æ®µ */
        .author-fields {
            margin-top: var(--space-md);
            padding-top: var(--space-md);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ç®¡ç†å‘˜æç¤º */
        .admin-notice {
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-medium);
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            font-size: var(--text-sm);
            color: var(--text-light);
            text-align: center;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 500px) {
            .login-page {
                padding: var(--space-sm);
            }

            .login-container {
                padding: var(--space-sm);
            }

            .login-card-header {
                padding: var(--space-lg) var(--space-lg) 0;
            }

            .form-scroll-container {
                padding: 0 var(--space-lg) var(--space-lg);
            }

            .login-logo h1 {
                font-size: var(--text-4xl);
            }

            .login-logo p {
                font-size: var(--text-base);
            }

            .role-tab {
                padding: var(--space-xs) var(--space-sm);
                font-size: var(--text-xs);
            }

            .remember-forgot {
                flex-direction: column;
                gap: var(--space-sm);
                align-items: flex-start;
            }

            .input-group input {
                padding: var(--space-sm) var(--space-lg) var(--space-sm) 45px;
            }
        }

        @media (max-width: 350px) {
            .login-logo h1 {
                font-size: var(--text-3xl);
            }

            .login-card-header {
                padding: var(--space-md) var(--space-md) 0;
            }

            .form-scroll-container {
                padding: 0 var(--space-md) var(--space-md);
            }

            .role-tabs {
                flex-direction: column;
                gap: var(--space-xs);
            }
        }

        /* èƒŒæ™¯åŠ¨ç”» */
        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
    </style>
</head>
<body class="login-page">
<div class="background-elements" id="backgroundElements"></div>

<!-- ç™»å½•é¡µé¢å†…å®¹ -->
<div class="login-container">
    <div class="login-card">
        <div class="login-card-header">
            <div class="login-logo">
                <h1>FlutterPage</h1>
                <p>å¼€å¯æ‚¨çš„åˆ›æ„å†™ä½œä¹‹æ—…</p>
            </div>

            <!-- èº«ä»½é€‰æ‹©å™¨ -->
            <div class="role-selector">
                <div class="role-tabs">
                    <div class="role-tab active" data-role="reader" data-form="login">è¯»è€…</div>
                    <div class="role-tab" data-role="author" data-form="login">ä½œè€…</div>
                    <div class="role-tab" data-role="admin" data-form="login">ç®¡ç†å‘˜</div>
                </div>
                <div class="role-description" id="roleDescription">
                    ä½œä¸ºè¯»è€…æµè§ˆå’Œé˜…è¯»å°è¯´
                </div>
            </div>
        </div>

        <!-- è¡¨å•æ»šåŠ¨å®¹å™¨ -->
        <div class="form-scroll-container" id="formScrollContainer">
            <!-- è¯»è€…ç™»å½•è¡¨å• -->
            <form id="readerLoginForm" class="auth-form active" data-role="reader" data-form="login">
                <div class="input-group">
                    <input type="text" id="readerLoginUsername" placeholder="ç”¨æˆ·åæˆ–é‚®ç®±" required>
                    <i class="fas fa-user"></i>
                    <div class="error-message" id="readerLoginUsernameError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="readerLoginPassword" placeholder="å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="readerLoginPasswordError"></div>
                </div>

                <div class="remember-forgot">
                    <label class="remember">
                        <input type="checkbox" id="readerRememberMe"> è®°ä½æˆ‘
                    </label>
                    <a href="#" class="forgot-link" id="readerForgotPassword">å¿˜è®°å¯†ç ?</a>
                </div>

                <button type="submit" class="login-btn" id="readerLoginBtn">ç™»å½•</button>

                <div class="form-switch">
                    <p>è¿˜æ²¡æœ‰è´¦å·? <a class="switch-link" data-role="reader" data-form="register">æ³¨å†Œè¯»è€…</a></p>
                </div>
            </form>

            <!-- è¯»è€…æ³¨å†Œè¡¨å• -->
            <form id="readerRegisterForm" class="auth-form" data-role="reader" data-form="register">
                <div class="input-group">
                    <input type="text" id="readerRegisterUsername" placeholder="ç”¨æˆ·å" required>
                    <i class="fas fa-user"></i>
                    <div class="error-message" id="readerRegisterUsernameError"></div>
                </div>

                <div class="input-group">
                    <input type="email" id="readerRegisterEmail" placeholder="é‚®ç®±åœ°å€" required>
                    <i class="fas fa-envelope"></i>
                    <div class="error-message" id="readerRegisterEmailError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="readerRegisterPassword" placeholder="å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="readerRegisterPasswordError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="readerRegisterConfirmPassword" placeholder="ç¡®è®¤å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="readerRegisterConfirmPasswordError"></div>
                </div>

                <button type="submit" class="login-btn" id="readerRegisterBtn">æ³¨å†Œè¯»è€…</button>

                <div class="form-switch">
                    <p>å·²æœ‰è´¦å·? <a class="switch-link" data-role="reader" data-form="login">ç«‹å³ç™»å½•</a></p>
                </div>
            </form>

            <!-- ä½œè€…ç™»å½•è¡¨å• -->
            <form id="authorLoginForm" class="auth-form" data-role="author" data-form="login">
                <div class="input-group">
                    <input type="text" id="authorLoginUsername" placeholder="ç”¨æˆ·åæˆ–é‚®ç®±" required>
                    <i class="fas fa-user"></i>
                    <div class="error-message" id="authorLoginUsernameError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="authorLoginPassword" placeholder="å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="authorLoginPasswordError"></div>
                </div>

                <div class="remember-forgot">
                    <label class="remember">
                        <input type="checkbox" id="authorRememberMe"> è®°ä½æˆ‘
                    </label>
                    <a href="#" class="forgot-link" id="authorForgotPassword">å¿˜è®°å¯†ç ?</a>
                </div>

                <button type="submit" class="login-btn" id="authorLoginBtn">ç™»å½•</button>

                <div class="form-switch">
                    <p>è¿˜æ²¡æœ‰ä½œè€…è´¦å·? <a class="switch-link" data-role="author" data-form="register">æ³¨å†Œä½œè€…</a></p>
                </div>
            </form>

            <!-- ä½œè€…æ³¨å†Œè¡¨å• -->
            <form id="authorRegisterForm" class="auth-form" data-role="author" data-form="register">
                <div class="input-group">
                    <input type="text" id="authorRegisterUsername" placeholder="ç”¨æˆ·å" required>
                    <i class="fas fa-user"></i>
                    <div class="error-message" id="authorRegisterUsernameError"></div>
                </div>

                <div class="input-group">
                    <input type="email" id="authorRegisterEmail" placeholder="é‚®ç®±åœ°å€" required>
                    <i class="fas fa-envelope"></i>
                    <div class="error-message" id="authorRegisterEmailError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="authorRegisterPassword" placeholder="å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="authorRegisterPasswordError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="authorRegisterConfirmPassword" placeholder="ç¡®è®¤å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="authorRegisterConfirmPasswordError"></div>
                </div>

                <!-- ä½œè€…é¢å¤–ä¿¡æ¯ -->
                <div class="author-fields">
                    <div class="input-group">
                        <input type="text" id="authorRegisterPenName" placeholder="ç¬”å" required>
                        <i class="fas fa-pen-nib"></i>
                        <div class="error-message" id="authorRegisterPenNameError"></div>
                    </div>

                    <div class="input-group">
                        <input type="text" id="authorRegisterRealName" placeholder="çœŸå®å§“å" required>
                        <i class="fas fa-id-card"></i>
                        <div class="error-message" id="authorRegisterRealNameError"></div>
                    </div>

                    <div class="input-group">
                        <input type="tel" id="authorRegisterPhone" placeholder="è”ç³»æ–¹å¼" required>
                        <i class="fas fa-phone"></i>
                        <div class="error-message" id="authorRegisterPhoneError"></div>
                    </div>

                    <div class="input-group">
                        <input type="text" id="authorRegisterIdCard" placeholder="èº«ä»½è¯å·" required>
                        <i class="fas fa-address-card"></i>
                        <div class="error-message" id="authorRegisterIdCardError"></div>
                    </div>
                </div>

                <button type="submit" class="login-btn" id="authorRegisterBtn">æ³¨å†Œä½œè€…</button>

                <div class="form-switch">
                    <p>å·²æœ‰ä½œè€…è´¦å·? <a class="switch-link" data-role="author" data-form="login">ç«‹å³ç™»å½•</a></p>
                </div>
            </form>

            <!-- ç®¡ç†å‘˜ç™»å½•è¡¨å• -->
            <form id="adminLoginForm" class="auth-form" data-role="admin" data-form="login">
                <div class="admin-notice">
                    ç®¡ç†å‘˜è´¦å·ç”±ç³»ç»Ÿåˆ†é…ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜è·å–è´¦å·ä¿¡æ¯
                </div>

                <div class="input-group">
                    <input type="text" id="adminLoginUsername" placeholder="ç®¡ç†å‘˜è´¦å·" required>
                    <i class="fas fa-user-shield"></i>
                    <div class="error-message" id="adminLoginUsernameError"></div>
                </div>

                <div class="input-group">
                    <input type="password" id="adminLoginPassword" placeholder="å¯†ç " required>
                    <i class="fas fa-lock"></i>
                    <div class="error-message" id="adminLoginPasswordError"></div>
                </div>

                <div class="input-group">
                    <input type="text" id="adminUid" placeholder="ç®¡ç†å‘˜UID" required>
                    <i class="fas fa-id-card"></i>
                    <div class="error-message" id="adminUidError"></div>
                </div>

                <button type="submit" class="login-btn" id="adminLoginBtn">ç®¡ç†å‘˜ç™»å½•</button>

                <div class="form-switch">
                    <p>ç®¡ç†å‘˜è´¦å·ç”±ç³»ç»Ÿåˆ†é…ï¼Œæ— æ³•è‡ªè¡Œæ³¨å†Œ</p>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- é€šçŸ¥ç»„ä»¶ -->
<div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">æ“ä½œæˆåŠŸï¼</span>
</div>

<script src="../static/js/common.js"></script>
<script>
    // ç™»å½•é¡µé¢æ§åˆ¶å™¨
    class LoginPageController {
        constructor() {
            this.currentRole = 'reader';
            this.currentForm = 'login';
            this.init();
        }

        init() {
            console.log('ğŸš€ åˆå§‹åŒ–ç™»å½•é¡µé¢...');

            // å¦‚æœå·²ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µ
            if (userManager.getCurrentUser()) {
                utils.showNotification('æ‚¨å·²ç™»å½•ï¼Œæ­£åœ¨è·³è½¬åˆ°é¦–é¡µ...');
                setTimeout(() => {
                    router.redirectToHome();
                }, 1500);
                return;
            }

            this.initRoleSelector();
            this.initFormSwitches();
            this.initFormSubmission();
            this.scrollToTop();

            console.log('âœ… ç™»å½•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        }

        /**
         * åˆå§‹åŒ–è§’è‰²é€‰æ‹©å™¨
         */
        initRoleSelector() {
            const roleTabs = document.querySelectorAll('.role-tab');

            roleTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const role = e.target.getAttribute('data-role');
                    const form = e.target.getAttribute('data-form');

                    this.switchToRole(role, form);
                });
            });
        }

        /**
         * åˆå§‹åŒ–è¡¨å•åˆ‡æ¢é“¾æ¥
         */
        initFormSwitches() {
            const switchLinks = document.querySelectorAll('.switch-link');

            switchLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const role = e.target.getAttribute('data-role');
                    const form = e.target.getAttribute('data-form');

                    this.switchToRole(role, form);
                });
            });
        }

        /**
         * åˆå§‹åŒ–è¡¨å•æäº¤
         */
        initFormSubmission() {
            // è¯»è€…ç™»å½•è¡¨å•
            const readerLoginForm = document.getElementById('readerLoginForm');
            if (readerLoginForm) {
                readerLoginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin('reader');
                });
            }

            // è¯»è€…æ³¨å†Œè¡¨å•
            const readerRegisterForm = document.getElementById('readerRegisterForm');
            if (readerRegisterForm) {
                readerRegisterForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister('reader');
                });
            }

            // ä½œè€…ç™»å½•è¡¨å•
            const authorLoginForm = document.getElementById('authorLoginForm');
            if (authorLoginForm) {
                authorLoginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin('author');
                });
            }

            // ä½œè€…æ³¨å†Œè¡¨å•
            const authorRegisterForm = document.getElementById('authorRegisterForm');
            if (authorRegisterForm) {
                authorRegisterForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister('author');
                });
            }

            // ç®¡ç†å‘˜ç™»å½•è¡¨å•
            const adminLoginForm = document.getElementById('adminLoginForm');
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin('admin');
                });
            }

            // å¿˜è®°å¯†ç é“¾æ¥
            const forgotLinks = document.querySelectorAll('.forgot-link');
            forgotLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    utils.showNotification('å¿˜è®°å¯†ç åŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å¼€æ”¾', false);
                });
            });
        }

        /**
         * åˆ‡æ¢åˆ°æŒ‡å®šè§’è‰²å’Œè¡¨å•
         * @param {string} role - è§’è‰² (reader, author, admin)
         * @param {string} form - è¡¨å•ç±»å‹ (login, register)
         */
        switchToRole(role, form = 'login') {
            this.currentRole = role;
            this.currentForm = form;

            // æ›´æ–°è§’è‰²æ ‡ç­¾
            this.updateRoleTabs(role, form);

            // æ›´æ–°è§’è‰²æè¿°
            this.updateRoleDescription(role, form);

            // æ˜¾ç¤ºå¯¹åº”çš„è¡¨å•
            this.showForm(role, form);

            // æ¸…é™¤æ‰€æœ‰é”™è¯¯ä¿¡æ¯
            this.clearAllErrors();

            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            this.scrollToTop();
        }

        /**
         * æ›´æ–°è§’è‰²æ ‡ç­¾çŠ¶æ€
         */
        updateRoleTabs(role, form) {
            const roleTabs = document.querySelectorAll('.role-tab');

            roleTabs.forEach(tab => {
                const tabRole = tab.getAttribute('data-role');
                const tabForm = tab.getAttribute('data-form');

                if (tabRole === role && tabForm === form) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }

        /**
         * æ›´æ–°è§’è‰²æè¿°
         */
        updateRoleDescription(role, form) {
            const roleDescription = document.getElementById('roleDescription');
            const descriptions = {
                reader: {
                    login: 'ä½œä¸ºè¯»è€…æµè§ˆå’Œé˜…è¯»å°è¯´',
                    register: 'æ³¨å†Œæˆä¸ºè¯»è€…ï¼Œäº«å—é˜…è¯»ä¹è¶£'
                },
                author: {
                    login: 'ä½œä¸ºä½œè€…å‘å¸ƒå’Œç®¡ç†æ‚¨çš„å°è¯´ä½œå“',
                    register: 'æ³¨å†Œæˆä¸ºä½œè€…ï¼Œå¼€å§‹æ‚¨çš„åˆ›ä½œä¹‹æ—…'
                },
                admin: {
                    login: 'ä½œä¸ºç®¡ç†å‘˜ç®¡ç†ç½‘ç«™å†…å®¹å’Œç”¨æˆ·'
                }
            };

            if (descriptions[role] && descriptions[role][form]) {
                roleDescription.textContent = descriptions[role][form];
            } else {
                roleDescription.textContent = '';
            }
        }

        /**
         * æ˜¾ç¤ºå¯¹åº”çš„è¡¨å•
         */
        showForm(role, form) {
            // éšè—æ‰€æœ‰è¡¨å•
            const allForms = document.querySelectorAll('.auth-form');
            allForms.forEach(formEl => {
                formEl.classList.remove('active');
            });

            // æ˜¾ç¤ºç›®æ ‡è¡¨å•
            const targetForm = document.querySelector(`.auth-form[data-role="${role}"][data-form="${form}"]`);
            if (targetForm) {
                setTimeout(() => {
                    targetForm.classList.add('active');
                }, 10);
            }
        }

        /**
         * å¤„ç†ç™»å½•
         */
        async handleLogin(role) {
            let isValid = true;
            let loginData = {};

            // éªŒè¯è¡¨å•
            if (role === 'reader') {
                isValid = this.validateReaderLogin();
                if (isValid) {
                    loginData = {
                        identifier: document.getElementById('readerLoginUsername').value.trim(),
                        password: document.getElementById('readerLoginPassword').value,
                        role: CONFIG.ROLES.READER
                    };
                }
            } else if (role === 'author') {
                isValid = this.validateAuthorLogin();
                if (isValid) {
                    loginData = {
                        identifier: document.getElementById('authorLoginUsername').value.trim(),
                        password: document.getElementById('authorLoginPassword').value,
                        role: CONFIG.ROLES.AUTHOR
                    };
                }
            } else if (role === 'admin') {
                isValid = this.validateAdminLogin();
                if (isValid) {
                    loginData = {
                        identifier: document.getElementById('adminLoginUsername').value.trim(),
                        password: document.getElementById('adminLoginPassword').value,
                        role: CONFIG.ROLES.ADMIN,
                        uid: document.getElementById('adminUid').value.trim()
                    };
                }
            }

            if (!isValid) return;

            const btn = this.getLoginButton(role);
            const originalText = btn.textContent;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            btn.textContent = 'ç™»å½•ä¸­...';
            btn.disabled = true;

            try {
                // ä½¿ç”¨APIç®¡ç†å™¨è¿›è¡Œç™»å½•
                const response = await apiManager.user.login(loginData);

                if (response.success) {
                    this.handleLoginSuccess(response.user, response.role);
                } else {
                    utils.showNotification(response.message, false);
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                utils.showNotification('ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', false);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        /**
         * å¤„ç†æ³¨å†Œ
         */
        async handleRegister(role) {
            let isValid = true;
            let registerData = {};

            // éªŒè¯è¡¨å•
            if (role === 'reader') {
                isValid = this.validateReaderRegister();
                if (isValid) {
                    registerData = {
                        username: document.getElementById('readerRegisterUsername').value.trim(),
                        email: document.getElementById('readerRegisterEmail').value.trim(),
                        password: document.getElementById('readerRegisterPassword').value,
                        role: CONFIG.ROLES.READER
                    };
                }
            } else if (role === 'author') {
                isValid = this.validateAuthorRegister();
                if (isValid) {
                    registerData = {
                        username: document.getElementById('authorRegisterUsername').value.trim(),
                        email: document.getElementById('authorRegisterEmail').value.trim(),
                        password: document.getElementById('authorRegisterPassword').value,
                        penName: document.getElementById('authorRegisterPenName').value.trim(),
                        realName: document.getElementById('authorRegisterRealName').value.trim(),
                        phone: document.getElementById('authorRegisterPhone').value.trim(),
                        idCard: document.getElementById('authorRegisterIdCard').value.trim(),
                        role: CONFIG.ROLES.AUTHOR
                    };
                }
            }

            if (!isValid) return;

            const btn = this.getRegisterButton(role);
            const originalText = btn.textContent;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            btn.textContent = 'æ³¨å†Œä¸­...';
            btn.disabled = true;

            try {
                let response;

                if (role === 'reader') {
                    response = await apiManager.user.register(registerData);
                } else if (role === 'author') {
                    response = await apiManager.user.registerAuthor(registerData);
                }

                if (response.success) {
                    let message = 'æ³¨å†ŒæˆåŠŸï¼';
                    if (role === 'author' && response.authorId) {
                        message = `ä½œè€…æ³¨å†ŒæˆåŠŸï¼æ‚¨çš„ä½œè€…IDæ˜¯: ${response.authorId}`;
                    }

                    utils.showNotification(message);

                    // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•
                    setTimeout(() => {
                        this.switchToRole(role, 'login');

                        // è‡ªåŠ¨å¡«å……ç”¨æˆ·å
                        const usernameInput = document.getElementById(`${role}LoginUsername`);
                        if (usernameInput) {
                            usernameInput.value = registerData.username;
                        }
                    }, 1500);
                } else {
                    utils.showNotification(response.message, false);
                }
            } catch (error) {
                console.error('æ³¨å†Œé”™è¯¯:', error);
                utils.showNotification('æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', false);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        /**
         * éªŒè¯è¯»è€…ç™»å½•è¡¨å•
         */
        validateReaderLogin() {
            let isValid = true;

            const username = document.getElementById('readerLoginUsername').value.trim();
            const password = document.getElementById('readerLoginPassword').value;

            if (!username) {
                this.showError('readerLoginUsername', 'è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±');
                isValid = false;
            } else {
                this.clearError('readerLoginUsername');
            }

            if (!password) {
                this.showError('readerLoginPassword', 'è¯·è¾“å…¥å¯†ç ');
                isValid = false;
            } else {
                this.clearError('readerLoginPassword');
            }

            return isValid;
        }

        /**
         * éªŒè¯ä½œè€…ç™»å½•è¡¨å•
         */
        validateAuthorLogin() {
            let isValid = true;

            const username = document.getElementById('authorLoginUsername').value.trim();
            const password = document.getElementById('authorLoginPassword').value;

            if (!username) {
                this.showError('authorLoginUsername', 'è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±');
                isValid = false;
            } else {
                this.clearError('authorLoginUsername');
            }

            if (!password) {
                this.showError('authorLoginPassword', 'è¯·è¾“å…¥å¯†ç ');
                isValid = false;
            } else {
                this.clearError('authorLoginPassword');
            }

            return isValid;
        }

        /**
         * éªŒè¯ç®¡ç†å‘˜ç™»å½•è¡¨å•
         */
        validateAdminLogin() {
            let isValid = true;

            const username = document.getElementById('adminLoginUsername').value.trim();
            const password = document.getElementById('adminLoginPassword').value;
            const uid = document.getElementById('adminUid').value.trim();

            if (!username) {
                this.showError('adminLoginUsername', 'è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å·');
                isValid = false;
            } else {
                this.clearError('adminLoginUsername');
            }

            if (!password) {
                this.showError('adminLoginPassword', 'è¯·è¾“å…¥å¯†ç ');
                isValid = false;
            } else {
                this.clearError('adminLoginPassword');
            }

            if (!uid) {
                this.showError('adminUid', 'è¯·è¾“å…¥ç®¡ç†å‘˜UID');
                isValid = false;
            } else {
                this.clearError('adminUid');
            }

            return isValid;
        }

        /**
         * éªŒè¯è¯»è€…æ³¨å†Œè¡¨å•
         */
        validateReaderRegister() {
            let isValid = true;

            const username = document.getElementById('readerRegisterUsername').value.trim();
            const email = document.getElementById('readerRegisterEmail').value.trim();
            const password = document.getElementById('readerRegisterPassword').value;
            const confirmPassword = document.getElementById('readerRegisterConfirmPassword').value;

            // ç”¨æˆ·åéªŒè¯
            if (!username) {
                this.showError('readerRegisterUsername', 'è¯·è¾“å…¥ç”¨æˆ·å');
                isValid = false;
            } else if (username.length < 3) {
                this.showError('readerRegisterUsername', 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦');
                isValid = false;
            } else {
                this.clearError('readerRegisterUsername');
            }

            // é‚®ç®±éªŒè¯
            if (!email) {
                this.showError('readerRegisterEmail', 'è¯·è¾“å…¥é‚®ç®±åœ°å€');
                isValid = false;
            } else if (!userManager.validateEmail(email)) {
                this.showError('readerRegisterEmail', 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
                isValid = false;
            } else {
                this.clearError('readerRegisterEmail');
            }

            // å¯†ç éªŒè¯
            if (!password) {
                this.showError('readerRegisterPassword', 'è¯·è¾“å…¥å¯†ç ');
                isValid = false;
            } else if (password.length < 6) {
                this.showError('readerRegisterPassword', 'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦');
                isValid = false;
            } else {
                this.clearError('readerRegisterPassword');
            }

            // ç¡®è®¤å¯†ç éªŒè¯
            if (!confirmPassword) {
                this.showError('readerRegisterConfirmPassword', 'è¯·ç¡®è®¤å¯†ç ');
                isValid = false;
            } else if (password !== confirmPassword) {
                this.showError('readerRegisterConfirmPassword', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                isValid = false;
            } else {
                this.clearError('readerRegisterConfirmPassword');
            }

            return isValid;
        }

        /**
         * éªŒè¯ä½œè€…æ³¨å†Œè¡¨å•
         */
        validateAuthorRegister() {
            let isValid = true;

            const username = document.getElementById('authorRegisterUsername').value.trim();
            const email = document.getElementById('authorRegisterEmail').value.trim();
            const password = document.getElementById('authorRegisterPassword').value;
            const confirmPassword = document.getElementById('authorRegisterConfirmPassword').value;
            const penName = document.getElementById('authorRegisterPenName').value.trim();
            const realName = document.getElementById('authorRegisterRealName').value.trim();
            const phone = document.getElementById('authorRegisterPhone').value.trim();
            const idCard = document.getElementById('authorRegisterIdCard').value.trim();

            // ç”¨æˆ·åéªŒè¯
            if (!username) {
                this.showError('authorRegisterUsername', 'è¯·è¾“å…¥ç”¨æˆ·å');
                isValid = false;
            } else if (username.length < 3) {
                this.showError('authorRegisterUsername', 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦');
                isValid = false;
            } else {
                this.clearError('authorRegisterUsername');
            }

            // é‚®ç®±éªŒè¯
            if (!email) {
                this.showError('authorRegisterEmail', 'è¯·è¾“å…¥é‚®ç®±åœ°å€');
                isValid = false;
            } else if (!userManager.validateEmail(email)) {
                this.showError('authorRegisterEmail', 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
                isValid = false;
            } else {
                this.clearError('authorRegisterEmail');
            }

            // å¯†ç éªŒè¯
            if (!password) {
                this.showError('authorRegisterPassword', 'è¯·è¾“å…¥å¯†ç ');
                isValid = false;
            } else if (password.length < 6) {
                this.showError('authorRegisterPassword', 'å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦');
                isValid = false;
            } else {
                this.clearError('authorRegisterPassword');
            }

            // ç¡®è®¤å¯†ç éªŒè¯
            if (!confirmPassword) {
                this.showError('authorRegisterConfirmPassword', 'è¯·ç¡®è®¤å¯†ç ');
                isValid = false;
            } else if (password !== confirmPassword) {
                this.showError('authorRegisterConfirmPassword', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                isValid = false;
            } else {
                this.clearError('authorRegisterConfirmPassword');
            }

            // ç¬”åéªŒè¯
            if (!penName) {
                this.showError('authorRegisterPenName', 'è¯·è¾“å…¥ç¬”å');
                isValid = false;
            } else if (penName.length < 2) {
                this.showError('authorRegisterPenName', 'ç¬”åè‡³å°‘2ä¸ªå­—ç¬¦');
                isValid = false;
            } else {
                this.clearError('authorRegisterPenName');
            }

            // çœŸå®å§“åéªŒè¯
            if (!realName) {
                this.showError('authorRegisterRealName', 'è¯·è¾“å…¥çœŸå®å§“å');
                isValid = false;
            } else {
                this.clearError('authorRegisterRealName');
            }

            // è”ç³»æ–¹å¼éªŒè¯
            if (!phone) {
                this.showError('authorRegisterPhone', 'è¯·è¾“å…¥è”ç³»æ–¹å¼');
                isValid = false;
            } else if (!userManager.validatePhone(phone)) {
                this.showError('authorRegisterPhone', 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç ');
                isValid = false;
            } else {
                this.clearError('authorRegisterPhone');
            }

            // èº«ä»½è¯å·éªŒè¯
            if (!idCard) {
                this.showError('authorRegisterIdCard', 'è¯·è¾“å…¥èº«ä»½è¯å·');
                isValid = false;
            } else if (!userManager.validateIdCard(idCard)) {
                this.showError('authorRegisterIdCard', 'è¯·è¾“å…¥æœ‰æ•ˆçš„èº«ä»½è¯å·');
                isValid = false;
            } else {
                this.clearError('authorRegisterIdCard');
            }

            return isValid;
        }

        /**
         * ç™»å½•æˆåŠŸå¤„ç†
         */
        handleLoginSuccess(userData, role) {
            utils.showNotification('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...');

            // æ ¹æ®è§’è‰²è·³è½¬åˆ°ä¸åŒé¡µé¢
            setTimeout(() => {
                if (role === CONFIG.ROLES.AUTHOR) {
                    // ä½œè€…è·³è½¬åˆ°ä½œè€…ä»ªè¡¨æ¿
                    window.location.href = 'author/author-dashboard.html';
                } else if (role === CONFIG.ROLES.ADMIN) {
                    // ç®¡ç†å‘˜æ²¡æœ‰å•ç‹¬é¡µé¢ï¼Œè·³è½¬åˆ°é¦–é¡µ
                    utils.showNotification('ç®¡ç†å‘˜é¡µé¢æš‚æœªå¼€æ”¾ï¼Œè·³è½¬åˆ°é¦–é¡µ');
                    window.location.href = 'home.html';
                } else {
                    // è¯»è€…è·³è½¬åˆ°é¦–é¡µ
                    window.location.href = 'home.html';
                }
            }, 1500);
        }

        /**
         * è·å–ç™»å½•æŒ‰é’®
         */
        getLoginButton(role) {
            switch (role) {
                case 'reader':
                    return document.getElementById('readerLoginBtn');
                case 'author':
                    return document.getElementById('authorLoginBtn');
                case 'admin':
                    return document.getElementById('adminLoginBtn');
                default:
                    return null;
            }
        }

        /**
         * è·å–æ³¨å†ŒæŒ‰é’®
         */
        getRegisterButton(role) {
            switch (role) {
                case 'reader':
                    return document.getElementById('readerRegisterBtn');
                case 'author':
                    return document.getElementById('authorRegisterBtn');
                default:
                    return null;
            }
        }

        /**
         * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
         */
        showError(inputId, message) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(`${inputId}Error`);

            if (input && errorElement) {
                input.classList.add('input-error');
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }

        /**
         * æ¸…é™¤é”™è¯¯ä¿¡æ¯
         */
        clearError(inputId) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(`${inputId}Error`);

            if (input && errorElement) {
                input.classList.remove('input-error');
                errorElement.style.display = 'none';
            }
        }

        /**
         * æ¸…é™¤æ‰€æœ‰é”™è¯¯ä¿¡æ¯
         */
        clearAllErrors() {
            const errorMessages = document.querySelectorAll('.error-message');
            const errorInputs = document.querySelectorAll('.input-error');

            errorMessages.forEach(error => {
                error.style.display = 'none';
            });

            errorInputs.forEach(input => {
                input.classList.remove('input-error');
            });
        }

        /**
         * æ»šåŠ¨åˆ°é¡¶éƒ¨
         */
        scrollToTop() {
            const scrollContainer = document.getElementById('formScrollContainer');
            if (scrollContainer) {
                scrollContainer.scrollTop = 0;
            }
        }
    }

    // é¡µé¢åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        window.loginController = new LoginPageController();

        // é¡µé¢ç‰¹å®šåˆå§‹åŒ–å‡½æ•°
        window.initPage = function () {
            console.log('ğŸ“„ ç™»å½•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        };
    });
</script>
</body>
</html>